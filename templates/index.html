<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">Product Management</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Store</a></li>
                    {% if session.user_id %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">Login</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('register') }}">Register</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Product Management</h1>
        {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        <a href="{{ url_for('add_product_ui') }}" class="btn btn-primary mb-3">Add New Product</a>

        <!-- Search and Filter Form -->
        <div class="mb-3">
            <form action="{{ url_for('index') }}" method="GET">
                <div class="row g-2">
                    <div class="col-md-3">
                        <input type="text" name="q" class="form-control" placeholder="Search products..."
                            value="{{ request.args.get('q', '') }}">
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="category" class="form-control" placeholder="Filter by Category"
                            value="{{ request.args.get('category', '') }}">
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="brand" class="form-control" placeholder="Filter by Brand"
                            value="{{ request.args.get('brand', '') }}">
                    </div>
                    <div class="col-md-3">
                        <select name="in_stock" class="form-control">
                            <option value="">Stock Status</option>
                            <option value="true" {% if request.args.get('in_stock')=='true' %}selected{% endif %}>In
                                Stock</option>
                            <option value="false" {% if request.args.get('in_stock')=='false' %}selected{% endif %}>Out
                                of Stock</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="show_in_store" class="form-control">
                            <option value="">Store Visibility</option>
                            <option value="true" {% if request.args.get('show_in_store')=='true' %}selected{% endif %}>
                                Shown</option>
                            <option value="false" {% if request.args.get('show_in_store')=='false' %}selected{% endif
                                %}>Hidden</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary w-100">Search/Filter</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Previous Orders -->
        <h3>Previous Orders</h3>
        {% if orders %}
        <div class="row">
            {% for order in orders %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ order.product.product_name }}</h5>
                        <p>Quantity: {{ order.quantity }}</p>
                        <p>Order Date: {{ order.order_date.strftime('%Y-%m-%d') }}</p>
                        <p>Status: {{ order.status }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No previous orders.</p>
        {% endif %}

        <!-- Products -->
        <h3>Products</h3>
        <form id="bulk-delete-form" action="{{ url_for('delete_products') }}" method="POST">
            <button type="submit" class="btn btn-danger mb-3">Delete Selected</button>
            <div class="row">
                {% for product in products %}
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <input type="checkbox" name="product_ids[]" value="{{ product.id }}"
                                class="product-checkbox">
                            {% if product.product_image_urls %}
                            <img src="{{ product.product_image_urls.split(',')[0] }}" class="card-img-top"
                                alt="{{ product.product_name }}" style="max-height: 150px;">
                            {% else %}
                            <p>No images available</p>
                            {% endif %}
                            <h5 class="card-title">{{ product.product_name }}</h5>
                            <p class="card-text">{{ product.short_description }}</p>
                            <p>Brand: {{ product.brand }}</p>
                            <p>Category: {{ product.category }}</p>
                            <p>MRP: ${{ product.mrp }} | Offer Price: ${{ product.offer_price }}</p>
                            <p>SKU#: {{ product.sku }}</p>
                            <p>In Stock: {{ "Yes" if product.in_stock else "No" }} ({{ product.stock_number }} units)
                            </p>
                            <p>Show in Store: {{ "Yes" if product.show_in_store else "No" }}</p>
                            {% if product.variants %}
                            <p>Variants:</p>
                            <ul>
                                {% for variant in product.variants %}
                                <li>{{ variant.variant_name }}: ${{ variant.variant_price }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            {% if product.is_rubber %}
                            <p>Rubber Specifications:</p>
                            <ul>
                                {% if product.rubber_density %}<li>Density: {{ product.rubber_density }}</li>{% endif %}
                                {% if product.rubber_height %}<li>Height: {{ product.rubber_height }}</li>{% endif %}
                                {% if product.rubber_length %}<li>Length: {{ product.rubber_length }}</li>{% endif %}
                                {% if product.rubber_thickness %}<li>Thickness: {{ product.rubber_thickness }}</li>{%
                                endif %}
                                {% if product.rubber_description %}<li>Description: {{ product.rubber_description }}
                                </li>{% endif %}
                            </ul>
                            {% endif %}
                            {% if product.youtube_links %}
                            <p>YouTube Links:</p>
                            <ul>
                                {% for link in product.youtube_links.split(',') %}
                                <li><a href="{{ link }}" target="_blank">Watch</a></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            {% if product.additional_media_urls %}
                            <p>Additional Media:</p>
                            <ul>
                                {% for media in product.additional_media_urls.split(',') %}
                                <li><a href="{{ media }}" target="_blank">View</a></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            {% if product.technical_information %}
                            <p>Technical Information: {{ product.technical_information|safe }}</p>
                            {% endif %}
                            <p>Manufacturer: {{ product.manufacturer }}</p>
                            <p>Special Note: {{ product.special_note }}</p>
                            <p>WhatsApp: {{ product.whatsapp_number }}</p>
                            {% if product.download_pdfs %}
                            <p>PDFs:</p>
                            <ul>
                                {% for pdf in product.download_pdfs.split(',') %}
                                <li><a href="{{ pdf }}" target="_blank">Download PDF</a></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            <a href="{{ url_for('edit_product_ui', product_id=product.id) }}"
                                class="btn btn-warning">Edit</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </form>

        <!-- Pagination -->
        <nav>
            <ul class="pagination">
                {% if pagination.has_prev %}
                <li class="page-item"><a class="page-link"
                        href="{{ url_for('index', page=pagination.prev_num, q=query, category=request.args.get('category'), brand=request.args.get('brand'), in_stock=request.args.get('in_stock'), show_in_store=request.args.get('show_in_store')) }}">Previous</a>
                </li>
                {% endif %}
                {% for page in pagination.iter_pages() %}
                {% if page %}
                <li class="page-item {% if page == pagination.page %}active{% endif %}"><a class="page-link"
                        href="{{ url_for('index', page=page, q=query, category=request.args.get('category'), brand=request.args.get('brand'), in_stock=request.args.get('in_stock'), show_in_store=request.args.get('show_in_store')) }}">{{
                        page }}</a></li>
                {% else %}
                <li class="page-item"><span class="page-link">...</span></li>
                {% endif %}
                {% endfor %}
                {% if pagination.has_next %}
                <li class="page-item"><a class="page-link"
                        href="{{ url_for('index', page=pagination.next_num, q=query, category=request.args.get('category'), brand=request.args.get('brand'), in_stock=request.args.get('in_stock'), show_in_store=request.args.get('show_in_store')) }}">Next</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>